# 关卡二：诗牌寻踪（卡牌消除）详细设计

## 1. 游戏概述
一个基于记忆匹配机制的诗词卡牌消除游戏，玩家需要通过翻牌匹配诗句对子、诗人信息和关键词，培养对古诗的熟悉度和理解能力。

## 2. 核心玩法
- 玩家每次可翻开两张卡牌
- 匹配成功的卡牌保持正面朝上并淡出
- 匹配失败的卡牌延迟1.5秒后翻回背面
- 完成所有匹配获得胜利

## 3. 卡牌系统设计

### 3.1 卡牌类型
1. **诗句对牌**（24组，48张）
   - 上句与下句分别作为独立卡牌
   - 示例：「床前明月光」对应「疑是地上霜」
   
2. **诗人卡**（8组，16张）
   - 诗人肖像与对应名字为一组
   - 匹配成功后解锁诗人介绍视频
   
3. **关键词卡**（6组，12张）
   - 意象与释义配对
   - 示例：「明月」对应「象征思乡」
   - 匹配成功触发相关水墨动画

### 3.2 卡牌属性
```typescript
interface Card {
  id: number;          // 卡牌唯一标识
  type: CardType;      // 卡牌类型（诗句/诗人/关键词）
  pairId: number;      // 配对组ID
  content: string;     // 卡牌内容
  state: CardState;    // 当前状态
  position: Vector2;   // 位置坐标
}

enum CardType {
  VERSE,              // 诗句
  POET,               // 诗人
  KEYWORD             // 关键词
}

enum CardState {
  BACK,               // 背面朝上
  FRONT,              // 正面朝上
  MATCHED             // 已匹配
}
```

## 4. 难度设计

### 4.1 难度递进
1. **初级模式**
   - 仅包含诗句对牌
   - 6组配对（12张卡牌）
   - 无时间限制
   
2. **中级模式**
   - 混合诗句和诗人卡
   - 12组配对（24张卡牌）
   - 有时间限制：5分钟
   
3. **高级模式**
   - 包含所有类型卡牌
   - 19组配对（38张卡牌）
   - 时间限制：8分钟
   - 错误3次触发惩罚机制

### 4.2 辅助系统
1. **提示系统**
   - 每局3次提示机会
   - 提示会短暂闪烁一对匹配卡牌
   - 使用提示会降低最终得分

2. **错误处理**
   - 连续3次错误匹配触发诗人提示
   - 提示内容包含相关诗句背景或创作典故
   - 可选择跳过提示继续游戏

## 5. 奖励机制

### 5.1 得分规则
- 基础匹配：100分/组
- 连续匹配：额外50分/组
- 使用提示：-30分/次
- 时间奖励：剩余时间 × 10分

### 5.2 解锁内容
- 达到特定分数解锁新的卡牌背面样式
- 完成诗人卡匹配解锁诗人视频
- 收集关键词可解锁特殊水墨动画

## 6. 技术实现要点

### 6.1 核心算法
```javascript
// 卡牌洗牌算法
function shuffleCards(cards) {
  for (let i = cards.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [cards[i], cards[j]] = [cards[j], cards[i]];
  }
  return cards;
}

// 匹配检测
function checkMatch(card1, card2) {
  return card1.pairId === card2.pairId;
}

// 连续匹配计数器
function updateCombo(isMatched) {
  if (isMatched) {
    comboCount++;
    return comboCount * 50; // 连击加分
  }
  comboCount = 0;
  return 0;
}
```

### 6.2 性能优化
1. 卡牌预加载
2. 动画缓存
3. 内存池管理
4. 事件节流

## 7. UI/UX设计建议

### 7.1 界面布局
- 卡牌网格布局（自适应屏幕）
- 顶部状态栏（分数、时间、提示次数）
- 底部工具栏（暂停、重启、帮助）

### 7.2 视觉反馈
- 卡牌翻转动画：3D效果
- 匹配成功：金色粒子特效
- 匹配失败：红色闪烁提示
- 连击提示：屏幕角落显示连击数

## 8. 测试重点
1. 卡牌匹配逻辑准确性
2. 动画流畅度
3. 计分系统准确性
4. 难度平衡性
5. 内存占用监控 